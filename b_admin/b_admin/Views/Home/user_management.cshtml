
@{

    Layout = "~/Views/Shared/layout.cshtml";
    ViewBag.title = "مدیریت کاربران";
}



<div class="row">
    <div class="col-xs-12">
        <div class="box">
            <div class="box-header">
                <h3 class="box-title">وضعیت کاربران </h3>
                <p>مورد اعتماد:ثبت سفارش بدون پرداخت</p>
                <div class="box-tools">
                    <div class="input-group input-group-sm" style="width: 150px;">
                        <input type="text" name="table_search" class="form-control pull-right" placeholder="جستجو">

                        <div class="input-group-btn">
                            <button type="submit" class="btn btn-default"><i class="fa fa-search"></i></button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /.box-header -->
            <div class="box-body table-responsive no-padding">
                <table class="table table-hover">

                    <thead>
                        <tr>

                            <th>نام</th>
                            <th>شماره تلفن</th>
                            <th>وضعیت فعلی</th>
                            <th>تغییر وضعیت</th>

                        </tr>
                    </thead>
                    <tbody id="tbl_user">
                    </tbody>
                </table>
            </div>

            <!-- /.box-body -->
        </div>
        <!-- /.box -->
    </div>
</div>



@section scripts{

    <script>
        $(document).ready(function () {
            $.post("/Home/getuser")
                .done(function (res) {
                    if (res.state) {
                        $("#tbl_user").empty();

                        for (var item in res.m) {

                            $("#tbl_user").append(
                                '<tr>' +
                                '<td>' + res.m[item].Name + '</td>' +
                                '<td > ' + res.m[item].Phone + '</td > ' +
                                '<td id="v_' + res.m[item].pkID + '"> ' + res.m[item].Status + '</td > ' +
                                '<td >'  + '<button id="eb_' + res.m[item].pkID + '" onclick="chgval(this.id)" class="btn btn-warning"> تغییر وضعیت</button>' + '</td>' +
                                '</tr>'

                            );

                        }
                    }
                    else {
                        swal("عملیات ناموفق", res.m, "error");
                    }

                })
                .fail(function () {

                    swal("عملیات ناموفق", "خطا در برقراری ارتباط با سرور", "error");

                })
                .always(function () {

                });

        });

        function chgval(id) {

            var token = $('input[name="__RequestVerificationToken"]').val();

            var a = id.split("_");

            

                swal({
                    text: 'وضعیت مورد نظر را وارد کنید',
                    content: "input",
                    button: {
                        text: "اعمال",
                        closeModal: false,
                    },
                })
                    .then(name => {
                        if (!name) throw null;

                        $.post("/Home/usertblch", { id: a[1], valuee: name, __RequestVerificationToken: token })

                            .done(function (res) {
                                console.log(res);
                                if (res.state) {
                                    $("#v_" + a[1]).html(res.m);
                                    swal("عملیات موفق", "مقدار مورد نظر به روز رسانی شد", "success");
                                }
                                else {
                                    swal("خطا", res.m, "error");
                                }
                            })
                            .fail(function () {
                                swal("خطا", "عدم برقراری ارتباط با سرور", "error");
                            });
                    });
            } 

        


    </script>



}


